{"componentChunkName":"component---src-templates-post-tsx-content-file-path-src-posts-2019-react-useposition-hook-index-md","path":"/blog/2019/react-useposition-hook/","result":{"data":{"mdx":{"id":"9cf4f6d1-53df-5e1a-9f3e-cc85cff26b96","body":"\r\n![usePosition](assets/01-cover.jpeg)\r\n\r\n## TL;DR\r\n\r\nIn this article we’ll create a React _usePosition()_ hook to fetch and follow browser’s location. Under the hood we’ll use [getCurrentPosition](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/getCurrentPosition) and [watchPosition](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/watchPosition) functions that are provided by global object _navigator.geolocation_. The final version of the _usePosition()_ hook is [published on GitHub](https://github.com/trekhleb/use-position) and [NPM](https://www.npmjs.com/package/use-position) and is ready to be consumed by your apps.\r\n\r\n## Why we might need usePosition() hook at all\r\n\r\nOne of the advantages of [React hooks](https://reactjs.org/docs/hooks-intro.html) is _ability to separate concerns_. Instead of having a state object with, let’s say, geo-position **and** socket connection we might avoid using state at all and just use two different hooks that will handle the state management for us. Even more, instead of initiating browser position watcher **and** opening a socket connection in the same _componentDidMount()_ callback we might split this logic into two independent hooks. This gives us cleaner and more maintainable code.\r\n\r\n## How we’re going to usePosition() hook\r\n\r\nLet’s do some reverse engineering and imagine that we already have a _usePosition()_ hook implemented. Here is how we might want to use it:\r\n\r\n_⚠️ All code samples below use wrong symbol =≻ instead of => for lambda functions annotations. Be aware of this while copying the code and trying to execute it since it might not work. Please replace ≻ with > manually in your code. For some reason I had issues with pasting the > symbol inside the code block. Sorry for inconvenience._\r\n\r\n```javascript\r\nimport React from 'react';\r\nimport {usePosition} from './usePosition';\r\n\r\nexport const UsePositionDemo = () => {\r\n  const {latitude, longitude, error} = usePosition();\r\n  return (\r\n    <code>\r\n      latitude: {latitude}<br/>\r\n      longitude: {longitude}<br/>\r\n      error: {error}\r\n    </code>\r\n  );\r\n};\r\n```\r\n\r\nYou see, it is only one line with _usePosition()_ hook, and you already have the data (_latitude_ and _longitude_). We don’t even use _useState()_ and _useEffect()_ here. Position subscription and watcher cleanup is incapsulated in _usePosition()_ hook. Now, the redraw component magic will be handled for us by React, and we will see the _<code>…</code>_ block constantly being updated with the latest position value of the browser. Looks pretty neat and clean.\r\n\r\n### usePosition() hook implementation\r\n\r\nOur custom _usePosition()_ hook is just a JavaScript function that uses other hooks like [useState()](https://reactjs.org/docs/hooks-state.html) and [useEffect()](https://reactjs.org/docs/hooks-effect.html). It will look something like:\r\n\r\n```javascript\r\n// imports go here...\r\nexport const usePosition = () => {\r\n  // code goes here...\r\n}\r\n```\r\n\r\nWe will use _useEffect()_ hook to hook to the moment in time when a component (that will consume our hook) is rendered and to subscribe to geolocation changes. We will also use _useState()_ hook to store _latitude_, _longitude_ and _error_ message (in case if user won’t allow browser to share its position). So we need to import these hooks first:\r\n\r\n```javascript\r\nimport {useState, useEffect} from 'react';\r\n\r\nexport const usePosition = () => {\r\n  // code goes here...\r\n}\r\n```\r\n\r\nLet’s init a storage for position and for error:\r\n\r\n```javascript\r\nimport {useState, useEffect} from 'react';\r\n\r\nexport const usePosition = () => {\r\n  const [position, setPosition] = useState({});\r\n  const [error, setError] = useState(null);\r\n\r\n  // other code goes here...\r\n}\r\n```\r\n\r\nLet’s return a desirable values from the function. We don’t have them yet but let’s return initial values so far and fill them later:\r\n\r\n```javascript\r\nimport {useState, useEffect} from 'react';\r\n\r\nexport const usePosition = () => {\r\n  const [position, setPosition] = useState({});\r\n  const [error, setError] = useState(null);\r\n\r\n  // other code goes here...\r\n  return {...position, error};\r\n}\r\n```\r\n\r\nHere is a key part of our hook — fetching the browser’s position. We will execute fetching logic after component has been rendered (useEffect hook).\r\n\r\n```javascript\r\nimport {useState, useEffect} from 'react';\r\n\r\nexport const usePosition = () => {\r\n  const [position, setPosition] = useState({});\r\n  const [error, setError] = useState(null);\r\n\r\n  // callbacks will go here...\r\n  useEffect(() => {\r\n    const geo = navigator.geolocation;\r\n    if (!geo) {\r\n      setError('Geolocation is not supported');\r\n      return;\r\n    }\r\n    watcher = geo.watchPosition(onChange, onError);\r\n    return () => geo.clearWatch(watcher);\r\n  }, []);\r\n  return {...position, error};\r\n}\r\n```\r\n\r\nIn useEffect() hook we first do some checks to see if the browser is supporting _navigator.geolocation_. If geolocation is not supported we’re setting up an error and returning from the effect. In case if _navigator.geolocation_ is supported we subscribe to position changes by providing an _onChange()_ and _onError()_ callbacks (we’ll add them in a moment). Notice that we’re returning a lambda function from _useEffect()_. In that lambda function we are clearing the watcher once the component is unmounted. So this subscribe/unsubscribe logic will be handled internally by our _usePosition()_ hook and consumers shouldn’t worry about it.\r\n\r\nLet’s now add missing callbacks:\r\n\r\n```javascript\r\nimport {useState, useEffect} from 'react';\r\n\r\nexport const usePosition = () => {\r\n  const [position, setPosition] = useState({});\r\n  const [error, setError] = useState(null);\r\n\r\n  const onChange = ({coords}) => {\r\n    setPosition({\r\n      latitude: coords.latitude,\r\n      longitude: coords.longitude,\r\n    });\r\n  };\r\n  const onError = (error) => {\r\n    setError(error.message);\r\n  };\r\n  useEffect(() => {\r\n    const geo = navigator.geolocation;\r\n    if (!geo) {\r\n      setError('Geolocation is not supported');\r\n      return;\r\n    }\r\n    watcher = geo.watchPosition(onChange, onError);\r\n    return () => geo.clearWatch(watcher);\r\n  }, []);\r\n  return {...position, error};\r\n}\r\n```\r\n\r\nAnd we’re done. The hook _usePosition()_ may be consumed and it incapsulates only geolocation related logic.\r\n\r\n### Afterword\r\n\r\nYou may find a [demo](https://trekhleb.dev/use-position/) and more detailed implementation of [usePosition() hook on GitHub](https://github.com/trekhleb/use-position). I hope this example was informative for you. Happy coding!\r\n","fields":{"slug":"/blog/2019/react-useposition-hook/"},"internal":{"contentFilePath":"C:/prj/quangphucphung.github.io/src/posts/2019/react-useposition-hook/index.md"},"frontmatter":{"title":"Creating React usePosition() hook for getting browser's geolocation","summary":"Decoupling of geolocation logic into React hook","date":"30 June, 2019","cover":{"childImageSharp":{"gatsbyImageData":{"layout":"fullWidth","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/b2e801b0c809c1b2059b4e0d712a71b1/94180/01-cover.jpg","srcSet":"/static/b2e801b0c809c1b2059b4e0d712a71b1/60ada/01-cover.jpg 750w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/86260/01-cover.jpg 1080w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/30611/01-cover.jpg 1366w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/94180/01-cover.jpg 1800w","sizes":"100vw"},"sources":[{"srcSet":"/static/b2e801b0c809c1b2059b4e0d712a71b1/a56f8/01-cover.webp 750w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/07ed3/01-cover.webp 1080w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/7aea2/01-cover.webp 1366w,\n/static/b2e801b0c809c1b2059b4e0d712a71b1/016ff/01-cover.webp 1800w","type":"image/webp","sizes":"100vw"}]},"width":1,"height":0.45444444444444443}}}}}},"pageContext":{"slug":"/blog/2019/react-useposition-hook/","frontmatter":{"title":"Creating React usePosition() hook for getting browser's geolocation","summary":"Decoupling of geolocation logic into React hook","cover":"assets/01-cover.jpeg","date":"2019-06-30T00:00:00.000Z"}}},"staticQueryHashes":["3196427994"],"slicesMap":{}}